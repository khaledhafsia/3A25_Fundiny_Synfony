{% extends 'front/base.html.twig' %}

{% block title %}Article index{% endblock %}

{% block body %}
   
    <input type="text" id="searchInput" placeholder="Search by description">
     <div class="container mt-3">
        <a href="{{ path('app_article_new') }}" class="btn btn-primary mb-3">Create new Article</a>
    </div>
    
    <table class="table">
        <tbody>
            {% if articles is not empty %} 
                {% for article in articles %}
                    <tr>
                        <td colspan="3">
                            <hr> <!-- Line separator -->
                            <h4>{{ article.description }}</h4>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            {% if article.image %}
                                <img src="{{ asset('images/front/' ~ article.image) }}" alt="" style="max-width: 400px;">
                            {% else %}
                                No image
                            {% endif %}
                        </td>
                        <td>
                            <div class="comment-buttons">
                                <a href="{{ path('app_article_edit', {'id': article.id}) }}">Edit Article</a>
                            </div>
                            <form action="{{ path('app_article_delete', {'id': article.id}) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this article?');">
                                <input type="hidden" name="_method" value="DELETE">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ article.id) }}">
                                <div class="comment-buttons">
                                    <button type="submit" class="btn btn-danger">Delete Article</button>
                                </div>
                            </form>
                        </td>
                        <td>
                            <!-- Facebook and Twitter Share Buttons -->
                            <div class="mt-2">
                                <a 
                                    href="https://twitter.com/intent/tweet?text={{ article.description }} - Check out this article!&url={{ url('app_article_show', {'id': article.id}) }}"
                                    target="_blank" 
                                    class="btn btn-info"
                                    style="background-color: #1DA1F2; border-color: #1DA1F2;"
                                >
                                    Share on Twitter
                                </a>
                                <a 
                                    href="https://www.facebook.com/sharer/sharer.php?u={{ url('app_article_show', {'id': article.id})|url_encode }}&quote={{ article.description }} - Check out this article!"
                                    target="_blank"
                                    class="btn btn-info"
                                    style="background-color: #3b5998; border-color: #3b5998;"
                                >
                                    Share on Facebook
                                </a>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <form action="{{ path('app_comment_new') }}" method="post">
                                <input type="hidden" name="articleId" value="{{ article.id }}">
                                <div class="form-group">
                                    <label for="comment">Add Comment:</label>
                                    <textarea class="form-control" id="comment" name="comment" rows="3"></textarea>
                                </div>
                                <button type="submit" class="btn btn-success">Submit</button>
                            </form>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <h4>Comments</h4>
                            {% for comment in articleComments[article.id] %}
                                <div class="comment">
                                    <p>{{ comment.comment }}</p>
                                    <div class="comment-buttons">
                                        <a href="{{ path('app_comment_edit', {'commentid': comment.id}) }}" class="btn btn-primary">Edit Comment</a>
                                    </div>
                                  {#  <form action="{{ path('app_comment_delete', {'commentid': comment.id}) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this comment?');">
                                        <input type="hidden" name="_method" value="DELETE">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ comment.id) }}">
                                        <div class="comment-buttons">
                                            <button type="submit" class="btn btn-danger">Delete Comment</button>
                                        </div>
                                    </form>#}
                                </div>
                                <hr> <!-- Line separator -->
                            {% else %}
                                <p>No comments</p>
                            {% endfor %}
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="3">No records found</td>
                    </tr>
                {% endfor %}
            {% endif %}
            <tr>
                <td colspan="3">
                    <div class="container mt-5">
                        <h1 class="text-center">You can also discuss with our chatbot!</h1>

                        <div id="chat-box" style="border: 1px solid #ccc; height: 400px; overflow-y: auto; padding: 10px;">
                            <!-- Chat content will be dynamically inserted here -->
                        </div>

                        <div class="mt-3">
                            <form id="chat-form">
                                <div class="input-group">
                                    <input type="text" id="chat-input" class="form-control" placeholder="Type a message... Press Enter to send" />
                                    <button type="button" class="btn btn-primary" id="send-message">Send</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>

    

  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('searchInput');
        const articleRows = document.querySelectorAll('table tbody tr');

        searchInput.addEventListener('input', function () {
            const searchText = searchInput.value.trim().toLowerCase();

            articleRows.forEach(row => {
                const descriptionCell = row.querySelector('h4');
                const descriptionText = descriptionCell ? descriptionCell.textContent.trim().toLowerCase() : '';

                // Check if the description of the article matches the search text
                const visible = descriptionText.includes(searchText);

                // Show or hide the entire article row based on visibility
                row.style.display = visible ? '' : 'none';
            });
        });
    });
</script>

    <script>
        // Function to generate bot response
        function generateBotResponse(userMessage) {
            const lowerCaseMessage = userMessage.toLowerCase();

            // Check for investment-related keywords or patterns
            if (lowerCaseMessage.includes('investment')) {
                return 'Our investment options include stocks, bonds, and mutual funds. How can I assist you further with investments?';
            } else if (lowerCaseMessage.includes('project')) {
                return 'Our current projects focus on renewable energy and technology innovation. Would you like more details about our projects?';
            } else if (lowerCaseMessage.includes('roi')) {
                return 'Return on Investment (ROI) is a key metric we consider. What specific ROI information are you looking for?';
            } else if (lowerCaseMessage.includes('hello') || lowerCaseMessage.includes('hi')) {
                return 'Hello! How can I help you with your investments or projects today?';
            } else {
                return 'I\'m not sure I understand. Can you provide more details or rephrase your question?';
            }
        }

        // Function to handle form submission
        document.getElementById('chat-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form from reloading the page

            const chatInput = document.getElementById('chat-input');
            const chatBox = document.getElementById('chat-box');
            const userMessage = chatInput.value;

            if (userMessage.trim() === '') {
                console.warn("Cannot send empty messages.");
                return; // Do not send empty messages
            }

            // Display the user's message in the chat box
            const userMessageElement = document.createElement('div');
            userMessageElement.textContent = 'You: ' + userMessage;
            chatBox.appendChild(userMessageElement);

            // Generate the bot response
            const botResponse = generateBotResponse(userMessage);

            // Display the bot's response in the chat box
            const botResponseElement = document.createElement('div');
            botResponseElement.textContent = 'Bot: ' + botResponse;
            chatBox.appendChild(botResponseElement);

            // Scroll to the bottom of the chat box to keep the latest messages visible
            chatBox.scrollTop = chatBox.scrollHeight;

            // Clear the chat input
            chatInput.value = '';
        });
    </script>

    <style>
        .comment-buttons .btn {
            padding: 3px 3px; /* Adjust the padding as needed */
            font-size: 10px; /* Adjust the font size as needed */
        }
    </style>
{% endblock %}
